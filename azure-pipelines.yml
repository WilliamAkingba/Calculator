trigger:
  branches:
    include:
      - main
      - development

pool:
  vmImage: 'ubuntu-latest'

stages:
# Stage 1: Build
- stage: Build
  displayName: "Build Stage"
  jobs:
  - job: Build
    displayName: "Build and Test"
    steps:
    - script: |
        npm install
      displayName: "Install dependencies"
    - script: |
        npx eslint .
      displayName: "Run ESLint (Static Code Analysis)"
    - script: |
        npm test
      displayName: "Run Unit Tests"

# Stage 2: Deploy to Test
- stage: DeployToTest
  displayName: "Deploy to Test Environment"
  dependsOn: Build
  condition: succeeded() # Only runs if Build is successful
  jobs:
  - deployment: DeployToTest
    displayName: "Deploy to Test Environment"
    environment: Test # Links to the Test environment in Azure DevOps
    strategy:
      runOnce:
        deploy:
          steps:
          - script: echo "Deploying to Test Environment"
            displayName: "Deploy Application"

# Stage 3: Deploy to Production
- stage: DeployToProduction
  displayName: "Deploy to Production Environment"
  dependsOn: DeployToTest
  condition: succeeded() # Only runs if DeployToTest is successful
  jobs:
  - deployment: DeployToProduction
    displayName: "Deploy to Production Environment"
    environment: Production # Links to the Production environment in Azure DevOps
    strategy:
      runOnce:
        deploy:
          steps:
          - script: echo "Deploying to Production Environment"
            displayName: "Deploy Application"
